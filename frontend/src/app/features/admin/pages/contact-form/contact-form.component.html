<app-admin-header />

<main class="contact-form-page">
  <div class="contact-form-page__container">
    <div class="contact-form-page__back">
      <a routerLink="/admin/kontakte" class="contact-form-page__back-link">&larr; Zur&uuml;ck zur Liste</a>
    </div>

    <div class="contact-form-card">
      <h1 class="contact-form-card__title">
        @if (isEdit) {
          Kontakt bearbeiten
        } @else {
          Neuer Kontakt
        }
      </h1>

      @if (loading) {
        <div class="contact-form-card__loading">
          <div class="contact-form-card__spinner"></div>
          Kontakt wird geladen...
        </div>
      } @else {
        @if (isEdit && contact) {
          <div class="contact-form-card__meta">
            <div class="contact-form-card__meta-item">
              <span class="contact-form-card__meta-label">Anrufe</span>
              <span class="contact-form-card__meta-value">{{ contact.callCount }}</span>
            </div>
            <div class="contact-form-card__meta-item">
              <span class="contact-form-card__meta-label">Letzter Anruf</span>
              <span class="contact-form-card__meta-value">{{ formatDate(contact.lastCallAt) }}</span>
            </div>
            <div class="contact-form-card__meta-item">
              <span class="contact-form-card__meta-label">Erstellt</span>
              <span class="contact-form-card__meta-value">{{ formatDate(contact.createdAt) }}</span>
            </div>
          </div>
        }

        @if (error) {
          <div class="contact-form-card__error" role="alert">{{ error }}</div>
        }

        @if (success) {
          <div class="contact-form-card__success" role="status">{{ success }}</div>
        }

        <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
          <div class="contact-form-card__grid">
            <div class="contact-form-card__field contact-form-card__field--full">
              <label for="phone" class="contact-form-card__label">Telefonnummer *</label>
              <input
                id="phone"
                type="tel"
                formControlName="phone"
                class="contact-form-card__input"
                placeholder="+49 170 1234567"
                autocomplete="tel" />
              @if (getFieldError('phone')) {
                <span class="contact-form-card__field-error" role="alert">{{ getFieldError('phone') }}</span>
              }
            </div>

            <div class="contact-form-card__field">
              <label for="firstName" class="contact-form-card__label">Vorname</label>
              <input
                id="firstName"
                type="text"
                formControlName="firstName"
                class="contact-form-card__input"
                placeholder="Max"
                autocomplete="given-name" />
              @if (getFieldError('firstName')) {
                <span class="contact-form-card__field-error" role="alert">{{ getFieldError('firstName') }}</span>
              }
            </div>

            <div class="contact-form-card__field">
              <label for="lastName" class="contact-form-card__label">Nachname</label>
              <input
                id="lastName"
                type="text"
                formControlName="lastName"
                class="contact-form-card__input"
                placeholder="Mustermann"
                autocomplete="family-name" />
              @if (getFieldError('lastName')) {
                <span class="contact-form-card__field-error" role="alert">{{ getFieldError('lastName') }}</span>
              }
            </div>

            <div class="contact-form-card__field">
              <label for="companyName" class="contact-form-card__label">Firma</label>
              <input
                id="companyName"
                type="text"
                formControlName="companyName"
                class="contact-form-card__input"
                placeholder="Beispiel GmbH"
                autocomplete="organization" />
              @if (getFieldError('companyName')) {
                <span class="contact-form-card__field-error" role="alert">{{ getFieldError('companyName') }}</span>
              }
            </div>

            <div class="contact-form-card__field">
              <label for="email" class="contact-form-card__label">E-Mail</label>
              <input
                id="email"
                type="email"
                formControlName="email"
                class="contact-form-card__input"
                placeholder="max@beispiel.de"
                autocomplete="email" />
              @if (getFieldError('email')) {
                <span class="contact-form-card__field-error" role="alert">{{ getFieldError('email') }}</span>
              }
            </div>
          </div>

          <div class="contact-form-card__actions">
            <a routerLink="/admin/kontakte" class="contact-form-card__cancel">Abbrechen</a>
            <button type="submit" class="contact-form-card__submit" [disabled]="form.invalid || submitting">
              @if (submitting) {
                <span class="contact-form-card__btn-spinner"></span>
                Wird gespeichert...
              } @else if (isEdit) {
                Speichern
              } @else {
                Kontakt anlegen
              }
            </button>
          </div>
        </form>
      }
    </div>
  </div>
</main>
